<%#
  Barra lateral da disciplina.

  Variáveis:
    space: a disciplina.
    user: o usuário.
    management: se está sendo mostrada nas telas de gerenciamento (default false).
%>

<% management = false unless local_assigns.has_key? :management %>

<div class="entity-sidebar">
  <%= render "environments/sidebar_thumbnail", environment: space.course.environment %>

  <%# Gerenciamento. %>
  <% if management %>
    <div class="entity-sidebar-widget content-body">
      <div class="entity-sidebar-widget-section text-center">
        <%= link_to "← Gerenciar Curso",
          edit_environment_course_path(space.course.environment, space.course), class: "link-secondary" %>
      </div>
      <hr class="entity-sidebar-widget-separator">
      <div class="entity-sidebar-widget-section">
        <span class="entity-sidebar-widget-icon icon-space-gray_16_18 show text-replacement">Disciplina</span>
        <%= content_tag :span, space.name, class: "entity-sidebar-widget-name" %>
      </div>
      <hr class="entity-sidebar-widget-separator">
      <div class="entity-sidebar-widget-section text-center">
        <%= link_to "Adicionar Conteúdo", "#", class: "link-secondary" %>
      </div>
      <hr class="entity-sidebar-widget-separator">
      <div class="entity-sidebar-widget-section text-center">
        <%# TODO: Modal de convidar membros. %>
        <%= link_to "Convidar Membros", "#", class: "link-secondary" %>
      </div>
    </div>

    <%# Licenças e faturas. %>
    <% @screen = :empty %>
    <%= render "environments/admin/plans" %>

  <% else %>
    <%= render "bootstrap/breadcrumb_icons", current_entity: space %>

    <%= new_local_nav :spaces_new %>

    <div class="nav-local-balloon">
      <span class="nav-local-balloon-arrow icon-arrow-up-balloon-gray_20_8"></span>
      <span class="nav-local-balloon-title">Você na disciplina:</span>
      <%= render "spaces/lectures_progress", space: space, user: user %>
      <div class="nav-local-separator"></div>
      <% user_comments = Activity.from_hierarchy(space).where(user_id: user.id).count %>
      <%= content_tag :span, "Comentários: #{ user_comments }",
        class: "nav-local-balloon-item icon-comment-gray_16_18-before" %>
      <% user_help_requests = Help.from_hierarchy(space).where(user_id: user.id).count %>
      <%= content_tag :span, "Dúvidas: #{ user_help_requests }",
        class: "nav-local-balloon-item icon-request-help-gray_16_18-before" %>
    </div>
  <% end %>
</div>